{"version":3,"sources":["../../src/pages/order-history/order-history.module.ts","../../src/pages/order-history/order-history.ts"],"names":[],"mappings":"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","file":"6.js","sourcesContent":["import { NgModule } from \"@angular/core\";\nimport { IonicPageModule } from \"ionic-angular\";\nimport { OrderHistoryPage } from \"./order-history\";\n\n@NgModule({\n  declarations: [OrderHistoryPage],\n  imports: [IonicPageModule.forChild(OrderHistoryPage)]\n})\nexport class OrderHistoryPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/order-history/order-history.module.ts","import { Component } from \"@angular/core\";\nimport {\n  IonicPage,\n  NavController,\n  NavParams,\n  ToastController,\n  ModalController,\n  ModalOptions\n} from \"ionic-angular\";\nimport { AngularFireDatabase } from \"angularfire2/database\";\nimport { AngularFireAuth } from \"angularfire2/auth\";\nimport { AES256 } from \"@ionic-native/aes-256\";\n\n@IonicPage()\n@Component({\n  selector: \"page-order-history\",\n  templateUrl: \"order-history.html\"\n})\nexport class OrderHistoryPage {\n  items = [];\n  itemSold = [];\n  kA = [];\n  items2 = [];\n  itemSearch = [];\n  plainTextCard: any;\n  constructor(\n    public navCtrl: NavController,\n    private afAuth: AngularFireAuth,\n    private afDatabase: AngularFireDatabase,\n    private toast: ToastController,\n    private aes: AES256,\n    private modal: ModalController,\n    public navParams: NavParams\n  ) {}\n\n  ionViewDidLoad() {\n    this.retrieveBoughtListings();\n    this.retrieveSoldListings();\n  }\n\n  remove() {\n    var temp = [];\n    var target = event.srcElement;\n    var ticketClicked =\n      parseInt(\n        target.parentElement.parentElement.children.item(0).innerHTML.valueOf()\n      ) - 1;\n    console.log(ticketClicked);\n    temp.push(this.items[ticketClicked]);\n    console.log(temp);\n    temp.filter(v => {\n      var tempArray = [\n        {\n          Key: v.Key,\n          Name: v.Name,\n          Venue: v.Venue,\n          Price: v.Price,\n          Date: v.Date,\n          Seller: v.Seller,\n          Time: v.Time,\n          Payout: v.Payout,\n          Creation: v.Creation,\n          Charge: v.Charge\n        }\n      ];\n      this.afDatabase.list(`approvedTickets/${tempArray[0].Key}`).remove();\n      this.toast\n        .create({\n          message:\n            \"Ticket\" +\n            \" \" +\n            tempArray[0].Key +\n            \" \" +\n            \"has been removed from active listings\",\n          position: \"middle\",\n          duration: 2000\n        })\n        .present();\n      this.navCtrl.setRoot(\"HomePage\");\n      this.refresh();\n    });\n  }\n\n  refresh(): void {\n    window.location.reload();\n  }\n\n  async viewTicket() {\n    const button = event.srcElement;\n    var url = button.parentElement.parentElement.children.item(5).innerHTML;\n    console.log(url);\n    const myModalOpts: ModalOptions = {\n      enableBackdropDismiss: true,\n      showBackdrop: false\n    };\n    const imageToView = {\n      url: url\n    };\n    const myModal = this.modal.create(\n      \"ViewImageModalPage\",\n      { image: imageToView },\n      myModalOpts\n    );\n    myModal.present();\n  }\n\n  async retrieveSoldListings() {\n    const currentUser = this.afAuth.auth.currentUser.uid;\n    const ref = this.afDatabase.object(`sold/${currentUser}`);\n    ref.snapshotChanges().subscribe(snapshot => {\n      var allData = snapshot.payload.val();\n      var keyValues = Object.keys(allData);\n      console.log(keyValues);\n      for (var i = 0; i < keyValues.length; ) {\n        this.afDatabase\n          .object(`sold/${currentUser}/${keyValues[i]}`)\n          .snapshotChanges()\n          .subscribe(async data => {\n            const Artist = data.payload.child(`Artist`).val();\n            const AccountNo = data.payload.child(`AccountNo`).val();\n            const Date = data.payload.child(`Date`).val();\n            const FundRelease = data.payload.child(`FundRelease`).val();\n            const Price = data.payload.child(`Price`).val();\n            const SortCode = data.payload.child(`SortCode`).val();\n            const Venue = data.payload.child(`Venue`).val();\n            const Status = data.payload.child(`Status`).val();\n            var ticketObject = {\n              Artist: Artist,\n              Venue: Venue,\n              Date: Date,\n              Price: Price,\n              AccountNo: AccountNo,\n              FundRelease: FundRelease,\n              SortCode: SortCode,\n              Status: Status\n            };\n            this.itemSold.push(ticketObject);\n            console.log(this.itemSold);\n          });\n        i++;\n      }\n    });\n  }\n\n  async retrieveBoughtListings() {\n    const currentUser = this.afAuth.auth.currentUser.uid;\n    const ref = this.afDatabase.object(`bought/${currentUser}`);\n    ref.snapshotChanges().subscribe(snapshot => {\n      var allData = snapshot.payload.val();\n      var keyValues = Object.keys(allData);\n      for (var i = 0; i < keyValues.length;) {\n        this.afDatabase\n          .object(`bought/${currentUser}/${keyValues[i]}`)\n          .snapshotChanges()\n          .subscribe(async data => {\n            const Artist = data.payload.child(`Artist`).val();\n            var Card = data.payload.child(`Card`).val();\n            const Date = data.payload.child(`Date`).val();\n            const Time = data.payload.child(`Time`).val();\n            const Price = data.payload.child(`Price`).val();\n            const Ticket = data.payload.child(`Ticket`).val();\n            const Venue = data.payload.child(`Venue`).val();\n            const eIV = data.payload.child(`eIV`).val();\n            const eKey = data.payload.child(`eKey`).val();\n            await this.aes\n              .decrypt(eKey, eIV, Card)\n              .then(acc => (this.plainTextCard = acc))\n              .catch((error: any) => console.log(error));\n            var ticketObject = {\n              Artist: Artist,\n              Card: this.plainTextCard.substr(15),\n              Date: Date,\n              Time: Time,\n              Price: Price,\n              Ticket: Ticket,\n              Venue: Venue\n            };\n            this.items.push(ticketObject);\n            console.log(this.items);\n          });\n        i++;\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/order-history/order-history.ts"],"sourceRoot":""}