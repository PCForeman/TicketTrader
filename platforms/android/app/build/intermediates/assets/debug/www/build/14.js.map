{"version":3,"sources":["../../src/pages/account/account.module.ts","../../src/pages/account/account.ts"],"names":[],"mappings":"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","file":"14.js","sourcesContent":["import { NgModule } from \"@angular/core\";\nimport { IonicPageModule } from \"ionic-angular\";\nimport { AccountPage } from \"./account\";\n\n@NgModule({\n  declarations: [AccountPage],\n  imports: [IonicPageModule.forChild(AccountPage)]\n})\nexport class AccountPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/account/account.module.ts","import { Component } from \"@angular/core\";\nimport { AngularFireAuth } from \"angularfire2/auth\";\nimport { AngularFireDatabase, AngularFireObject } from \"angularfire2/database\";\nimport {\n  AlertController,\n  App,\n  IonicPage,\n  ModalController,\n  ModalOptions,\n  NavController,\n  NavParams,\n  ToastController\n} from \"ionic-angular\";\nimport { Observable } from \"rxjs\";\nimport { LoginPage } from \"../login/login\";\n\n@IonicPage()\n@Component({\n  selector: \"page-account\",\n  templateUrl: \"account.html\"\n})\nexport class AccountPage {\n  currentPassword: any;\n  comparePassword: any;\n  newPassword: any;\n  playerPassword: AngularFireObject<any>;\n  userData: Observable<any>;\n  gPassword: any;\n\n  constructor(\n    private afDatabase: AngularFireDatabase,\n    private afAuth: AngularFireAuth,\n    private toast: ToastController,\n    private app: App,\n    private modal: ModalController,\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private aCtrl: AlertController\n  ) {}\n\n  ionViewDidLoad() {\n    this.displayAccountData();\n  }\n\n  openModal() {\n    //Opens a modal and passes revelevant variables so they are in scope\n    var currentUser = this.afAuth.auth.currentUser.uid;\n    var ref = this.afDatabase.object(`user/${currentUser}`);\n    ref.snapshotChanges().subscribe(snapshot => {\n      const dob = snapshot.payload\n        .child(`dOb/`)\n        .val()\n        .toString();\n      const em = snapshot.payload\n        .child(`email/`)\n        .val()\n        .toString();\n      const fn = snapshot.payload\n        .child(`firstname/`)\n        .val()\n        .toString();\n      const pw = snapshot.payload\n        .child(`password/`)\n        .val()\n        .toString();\n      const pn = snapshot.payload\n        .child(`phoneNo/`)\n        .val()\n        .toString();\n      const sn = snapshot.payload\n        .child(`surname/`)\n        .val()\n        .toString();\n      const myModalOpts: ModalOptions = {\n        cssClass: \"modal\",\n        enableBackdropDismiss: true,\n        showBackdrop: true\n      };\n      const accountData = {\n        dOb: dob,\n        email: em,\n        password: pw,\n        firstname: fn,\n        phonenumber: pn,\n        surname: sn\n      };\n\n      const myModal = this.modal.create(\n        \"ModalAccountPage\",\n        { data: accountData },\n        myModalOpts\n      );\n      myModal.present();\n    });\n  }\n\n  addCard() {\n    //Opens a modal to add a payment method\n    const myModalOpts: ModalOptions = {\n      cssClass: \"modal\",\n      enableBackdropDismiss: true,\n      showBackdrop: true\n    };\n    const listingRef = {};\n\n    const myModal = this.modal.create(\n      \"AddCardModalPage\",\n      { ticket: listingRef },\n      myModalOpts\n    );\n    myModal.present();\n  }\n\n  async deleteAccount() {\n    //Deletes a users ticket trader account if condition is met.\n    var ref = this.afDatabase.object(\n      `user/${this.afAuth.auth.currentUser.uid}`\n    );\n    ref.snapshotChanges().subscribe(snapshot => {\n      const pw = snapshot.payload\n        .child(`password/`)\n        .val()\n        .toString();\n      console.log(pw);\n      let alert = this.aCtrl.create({\n        title: \"Enter password to delete account\",\n        inputs: [\n          {\n            name: \"password\",\n            placeholder: \"Password\",\n            type: \"password\"\n          }\n        ],\n        buttons: [\n          {\n            text: \"Cancel\",\n            role: \"cancel\",\n            handler: cancelled => {\n              console.log(\"Cancel clicked\");\n            }\n          },\n          {\n            text: \"Delete\",\n            handler: data => {\n              console.log(data);\n              if (data.password == pw) {\n                try {\n                  var tempKey = this.afAuth.auth.currentUser.uid;\n                  console.log(tempKey);\n                  this.logout();\n                  this.app.getRootNav().setRoot(LoginPage);\n                  this.afAuth.auth.signOut();\n                  this.afDatabase.object(`user/${tempKey}`).remove();\n                } catch (e) {\n                  console.log(e);\n                }\n              } else {\n                this.toast\n                  .create({\n                    message: \"Incorrect password\",\n                    duration: 2000,\n                    position: \"middle\"\n                  })\n                  .present();\n                return false;\n              }\n            }\n          }\n        ]\n      });\n      alert.present();\n    });\n  }\n\n  checkOut() {\n    // Redirects to the checkout tab\n    this.navCtrl.push(\"BuyPage\");\n  }\n\n  orderHistory() {\n    //Redirects to the orderHistory tab\n    this.navCtrl.push(\"OrderHistoryPage\");\n  }\n\n  displayAccountData() {\n    //Fetchs a users details from the database and makes them an observable\n    this.afAuth.authState.take(1).subscribe(data => {\n      if (data && data.email && data.uid) {\n        this.userData = this.afDatabase\n          .object(`user/${data.uid}`)\n          .valueChanges();\n      } else {\n        this.toast\n          .create({\n            message: `Could not find authentication details`,\n            position: \"middle\",\n            duration: 3000\n          })\n          .present();\n      }\n    });\n  }\n\n  logout() {\n    //Signs user out and re-routes them to login page\n    this.afAuth.auth.signOut().then(() => {\n      this.toast\n        .create({\n          message: \"Signed out\",\n          position: \"middle\",\n          duration: 3500\n        })\n        .present();\n      this.app.getRootNav().setRoot(\"LoginPage\");\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/account/account.ts"],"sourceRoot":""}