{"version":3,"sources":["../../src/pages/payment-modal/payment-modal.module.ts","../../src/pages/payment-modal/payment-modal.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from \"@angular/core\";\nimport { IonicPageModule } from \"ionic-angular\";\nimport { PaymentModalPage } from \"./payment-modal\";\n\n@NgModule({\n  declarations: [PaymentModalPage],\n  imports: [IonicPageModule.forChild(PaymentModalPage)]\n})\nexport class PaymentModalPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/payment-modal/payment-modal.module.ts","import { Component } from \"@angular/core\";\nimport {\n  IonicPage,\n  NavParams,\n  ViewController,\n  AlertController\n} from \"ionic-angular\";\nimport { AngularFireDatabase } from \"angularfire2/database\";\nimport { sharedStylesheetJitUrl } from \"@angular/compiler\";\n\n@IonicPage()\n@Component({\n  selector: \"page-payment-modal\",\n  templateUrl: \"payment-modal.html\"\n})\nexport class PaymentModalPage {\n  constructor(\n    public navParams: NavParams,\n    private aCtrl: AlertController,\n    private vCtrl: ViewController,\n    private afDatabase: AngularFireDatabase\n  ) {}\n  listingData: any;\n  cardName: any;\n  CVC: any;\n  cardNo: any;\n  expiry: any;\n\n  ionViewWillLoad() {\n    const ticket = this.navParams.get(\"ticket\");\n    this.listingData = ticket;\n    console.log(ticket);\n    this.useExistingCard();\n  }\n\n  close() {\n    this.vCtrl.dismiss();\n  }\n\n  useExistingCard() {\n    var key = this.listingData.userId;\n    this.afDatabase\n      .object(`user/${key}`)\n      .snapshotChanges()\n      .subscribe(snapshot => {\n        var allData = snapshot.payload.val();\n        var value = Object.keys(allData);\n        var cardKey = value[0];\n        this.afDatabase\n          .object(`user/${key}/${cardKey}`)\n          .snapshotChanges()\n          .subscribe(snapshot => {\n            const CardNo = snapshot.payload.child(`Card`).val();\n            const CVC = snapshot.payload.child(`CVC`).val();\n            const cardExpiry = snapshot.payload.child(`Expiry`).val();\n            const Holder = snapshot.payload.child(`Holder`).val();\n            var CardSubStr = CardNo.toString().substr(12, 4);\n            var cardNoString =\n              CardNo.toString().substr(0, 4) +\n              \"-\" +\n              CardNo.toString().substr(4, 4) +\n              \"-\" +\n              CardNo.toString().substr(8, 4) +\n              \"-\" +\n              CardNo.toString().substr(12, 4);\n            let alert = this.aCtrl.create({\n              title: \"Payment\",\n              message:\n                \"Use card ending in\" + \" \" + CardSubStr + \" \" + \"for payment?\",\n              buttons: [\n                {\n                  text: \"NO\",\n                  role: \"cancel\",\n                  handler: () => {\n                    console.log(\"Cancel clicked\");\n                  }\n                },\n                {\n                  text: \"YES\",\n                  handler: () => {\n                    this.cardName = Holder;\n                    this.cardNo = cardNoString;\n                    this.expiry = cardExpiry;\n                    this.CVC = CVC;\n                  }\n                }\n              ]\n            });\n            alert.present();\n          });\n      });\n  }\n\n  processPayment(){\n    console.log(this.listingData.userId)\n    var saleRef =\n     [{Seller: this.listingData.sellerId,\n       TicketRef: this.listingData.ticketRef,\n       Buyer: this.listingData.userId,\n       Price: this.listingData.price\n     }]\n     console.log(saleRef);\n    this.afDatabase.list(`transactions`).push(saleRef[0]);\n    this.afDatabase.list(`orderHistory`);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/payment-modal/payment-modal.ts"],"sourceRoot":""}